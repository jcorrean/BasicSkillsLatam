---
title: "A Cross-National Comparison Case Study on the Basic Skills Academic Offering"
format: html
keywords: 
  - Basic Skills
  - Academic Offering
  - Latin American
  - Bipartite Network Modeling
abstract: |
  This supplementary material aims to expand the data and methodological documentation of the work: "*A Cross-National Comparison Case Study on the Basic Skills Academic Offering.*" Emphasis is placed on how to use the associated [GitHub repository](https://github.com/jcorrean/SoftSkillsLatam) for R users with expertise in network data science.
---

```{r, echo = FALSE, warning = FALSE}
# Packages
suppressPackageStartupMessages(library(tidyverse)) # Data wrangling
suppressPackageStartupMessages(library(ggplot2)) # Data visualization
suppressPackageStartupMessages(library(dplyr)) # Data wrangling
suppressPackageStartupMessages(library(gridExtra)) # arrange plots of ggplot 
suppressPackageStartupMessages(library(igraph)) # for modeling data as network
suppressPackageStartupMessages(library(network)) # for modeling and analyzing data as network
suppressPackageStartupMessages(library(ergm)) # for network-based statistical inference
suppressPackageStartupMessages(library(ergm.multi)) # for multivariate network-based statistical inference
suppressPackageStartupMessages(library(kableExtra)) # tables
suppressPackageStartupMessages(library(ggmosaic)) # tables
suppressPackageStartupMessages(library(knitr))
suppressPackageStartupMessages(library(broom)) # Convert Statistical 
suppressPackageStartupMessages(library(purrr)) # for mapping functions and vectors
suppressPackageStartupMessages(library(tibble)) # for tibbles
suppressPackageStartupMessages(library(psych)) # for multivariate analysis
```


# The Data

The codes developed to preprocess the raw data is available in the following [GitHub repository](https://github.com/jcorrean/BasicSkillsLatam) are associated to the RProject file. 

## Raw data and pre-processing

Raw data are available as texts (PDF or docx files) in the folder of the corresponding sampled country. For example, sampled documents from Argentina are available in the folder "Argentina," documents from Brazil are available in the folder "Brazil," and so on. Texts pre-processing were handled with `readtext` and `quanteda` in a series of R scripts. These scripts are available in the folder "Pre-processing."

## Curated Data
As a convenient step in our analyses, we created the folder "Curated_Data" which provides curated data for each country. This curated data provides the estimated centrality for each basic skill in each country. Apart from these data, we also provide the NetworkData folder. This second folder contains the academic offering of each nation as a network data serialized in RDS format.

# Network analyses

Pre-processing texts result in a series of features-document matrices which are available in the folder "Matrices." We used these matrices as raw input for modeling the academic offering as a series of non-directed bipartite networks with the help of the `igraph` package.

## Network properties set up

The network properties of each nation's academic offering was done with the `network` package. The following network attributes are present for each academic offering: country of origin, membership to the Organization for Economic Development (OECD), network size, network density, network clustering (estimated by the `reinforcement_tm` algortihm available in the `tnet` package). Vertex attributes include the country of origin (for both node partitions), the length of the brochure (for nodes in the first partition), the degree centrality (for both node partitions), the eigenvector centrality (for both node partitions), the program level (for the first node partition), and the name of each skills (for nodes in the second partition). These vertex attributes enable us to exert statistical control when estimating the network effects in our series of exponential random graph models. 

# Regional Network Analysis

The following table summarizes the network statistics of the academic offering of graduate programs in Latin American sampled countries. In general terms, the academic offering is weakly connected to basic skills (network density ranges from 0.005 in Brazil and Ecuador to 0.061 in Costa Rica). The weak connectivity between programs and basic skills reveals that the academic offering from sampled universities in Latin America highlights other contents that have nothing to do with basic skills as developed capacities that facilitate learning and a faster acquisition of knowledge.

```{r, echo = FALSE}
RegionalNetworks <- readRDS("NetworkData/RegionalNetworks.RDS")
RegionalNetworks %>%
  imap(~ {
    mnext_value <- .x$gal$mnext
    list(
      Country = .y,
      OECD.Member = .x %n% "OECD",
      n = network.size(.x),
      d = network.density(.x),
      Clustering = get.network.attribute(.x, "Clustering"),
      mnext = ifelse(is.null(mnext_value), NA_integer_, mnext_value)
    )
  }) %>%
  bind_rows() %>%
  group_by(Country) %>%
  summarize(
    OECD.Member = first(OECD.Member),
    Edges = mnext,
    Size = sum(n),
    Density = mean(d),
    Clustering = first(Clustering)
  ) %>%
  kable()
```

Despite the weak connectivity between programs and skills and to address the artifact discussed in section 3.5 of the article, we compare programs' and skills' centrality as a function of program levels in each country (see Figure F1). 

```{r F1, fig.cap="Figure 1. Statistical distributions for the estimated importance of skills and programs.", echo=FALSE, fig.width=30, fig.height=18, warning=FALSE}
load("Results/Argentina.RData")
load("Results/Brazil.RData")
load("Results/Chile.RData")
load("Results/Colombia.RData")
load("Results/CostaRica.RData")
load("Results/Ecuador.RData")
load("Results/Mexico.RData")
load("Results/Uruguay.RData")
load("Results/Venezuela.RData")

rm(list=setdiff(ls(), c("ProgramsARG1", "ProgramsARG2", "ProgramsARG3",
                        "ProgramsBRA1", "ProgramsBRA2", "ProgramsBRA3",
                        "ProgramsCHL1", "ProgramsCHL2", "ProgramsCHL3",
                        "ProgramsCOL1", "ProgramsCOL2", "ProgramsCOL3",
                        "ProgramsCORI1", "ProgramsCORI2", "ProgramsCORI3",
                        "ProgramsECU1", "ProgramsECU2", "ProgramsECU3",
                        "ProgramsMEX1", "ProgramsMEX2", "ProgramsMEX3",
                        "ProgramsURU1", "ProgramsURU2", "ProgramsURU3",
                        "ProgramsVEN1", "ProgramsVEN2", "ProgramsVEN3")))

AllPrograms <- do.call(rbind, list(ProgramsARG1,
                                   ProgramsARG2,
                                   ProgramsARG3,
                                   ProgramsBRA1,
                                   ProgramsBRA2,
                                   ProgramsBRA3,
                                   ProgramsCHL1,
                                   ProgramsCHL2,
                                   ProgramsCHL3,
                                   ProgramsCOL1,
                                   ProgramsCOL2,
                                   ProgramsCOL3,
                                   ProgramsCORI1,
                                   ProgramsCORI2,
                                   ProgramsCORI3,
                                   ProgramsECU1,
                                   ProgramsECU2,
                                   ProgramsECU3,
                                   ProgramsMEX1,
                                   ProgramsMEX2,
                                   ProgramsMEX3,
                                   ProgramsURU1,
                                   ProgramsURU2,
                                   ProgramsURU3,
                                   ProgramsVEN1,
                                   ProgramsVEN2,
                                   ProgramsVEN3))


ggplot(AllPrograms, aes(x=Level, y=Eigenvector, fill = Partition)) +
  geom_violin() +
  scale_x_discrete(limits = c("Specialization", "Master", "PhD")) +
  facet_wrap(~Country) +
  theme_bw() +
  theme(legend.position = "bottom",
        legend.title=element_text(size=50), 
        legend.text=element_text(size=50),
        axis.title.x = element_text(size = 30, colour = "black"),
        axis.title.y = element_text(size = 30, colour = "black"),
        axis.text.x = element_text(size = 30, colour = "black"),
        axis.text.y = element_text(size = 30, colour = "black"),
        strip.text = element_text(face="bold", size=rel(3.5), colour = "black"),
        strip.background = element_rect(fill="grey", colour="grey",
                                        size=30)) +
  xlab("") + ylab("Estimated importance") +
  labs(fill="")+
  scale_fill_manual(values = c("Skill" = "#09419e", "Program" = "red2"))
```

The next Figure shows the estimated centrality for each basic skill in each country. Scientific reasoning (science) proved to be the first basic skill with the highest centrality regardless of the local academic offering available in each country. Apart from scientific reasoning (science), other skills are important as well (e.g., speaking, learning strategy, active listening, reading comprehension). By ranking the importance of these skills, we now have sufficient evidence to estimate their importance following the logic of exponential random graph model. In the following section, we provide inferential evidence on the importance of these skills for the academic offering.


```{r F2, fig.cap="Figure 2. Estimated importance of basic skills by country.", echo=FALSE, fig.width=40, fig.height=18, warning=FALSE}

Skills <- AllPrograms %>% filter(., Partition == "Skill")
Skills$Node <- gsub("^(ARG|BRA|CHL|COL|CR|ECU|MEX|URU|VEN)_", "", Skills$Node)
Skills$Level <- factor(Skills$Level, levels = c("Specialization", "Master", "PhD"))

ggplot(Skills, aes(x=reorder(Node, -Eigenvector), y=Eigenvector, fill = Level))+
  geom_bar(position = "stack", stat = "identity") +
  scale_fill_manual("", values = c("Specialization" = "lightskyblue2", "Master" = "lightsteelblue3", "PhD" = "royalblue4")) +
#  scale_fill_manual(values = c("steelblue1", "slateblue1", "slateblue4")) +
  facet_wrap(. ~ Country) +
  theme_linedraw() +
  coord_flip()+
  theme(axis.text.x = element_text(angle=0, hjust=1, size = 30),
        axis.text.y = element_text(size = 30),
        axis.title.x = element_text(size = 30, colour = "black"),
        axis.title.y = element_text(size = 50, colour = "black"),
        legend.text = element_text(size = 30),  
        legend.title = element_text(size = 20), 
        strip.text = element_text(face="bold", size=rel(3.5), colour = "black"),
        strip.background = element_rect(fill="grey", colour="grey",
                                        size=30))+
  xlab("") + ylab("Eigenvector centrality of basic skills") +
  labs(fill="")
```



# Inferential Network Analysis

```{r, echo=FALSE, warning=FALSE, message=FALSE}
RegionalNetworks <- readRDS("NetworkData/RegionalNetworks.RDS")
SampledNetworks <- Networks(RegionalNetworks)


model1 <- ergm(SampledNetworks ~ edges)
summary(model1)
```

